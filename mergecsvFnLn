 # Vincent PAUL-VICTOR 13/02/2020

import pandas as pd

# csv en utf8
# fichier csv liste electorale ville, cp, adresse
input1='/Users/VPV/Dropbox/DigitaleBox/DB Relation Client/Base de données/Benoit Jimenez Garges-les-gonesse/201117/draft/LE2020.csv' 

# fichier avec nom prenom et email mobile
input2='/Users/VPV/Dropbox/DigitaleBox/DB Relation Client/Base de données/Benoit Jimenez Garges-les-gonesse/201117/draft/mobile.csv'


df1 = pd.read_csv(input1)
df2 = pd.read_csv(input2)


# strip les espaces avant et apres nom prenom
df1['prenom'] = df1['prenom'].str.strip()
df1['nom'] = df1['nom'].str.strip()



# majuscule 1er lettre nom prenom
df1['nom'] = df1['nom'].str.capitalize()
df1['prenom'] = df1['prenom'].str.capitalize()




# strip les espaces avant et apres nom prenom

df2['prenom'] = df2['prenom'].str.strip()
df2['nom'] = df2['nom'].str.strip()


# majuscule 1er lettre nom prenom
df2['prenom'] = df2['prenom'].str.capitalize()
df2['nom'] = df2['nom'].str.capitalize()


# cherche les duplicates et creation 2 fichiers duplicate

dfdup1=df1[df1.duplicated(['prenom', 'nom'], keep=False)]
dfdup2=df2[df2.duplicated(['prenom', 'nom'], keep=False)] 

dfdup1.to_csv('/Users/VPV/Desktop/Duplicate1.csv', encoding='utf8', index=False)
dfdup2.to_csv('/Users/VPV/Desktop/Duplicate2.csv', encoding='utf8', index=False)


# supprime les duplicates du fichier merge

df1=df1.drop_duplicates(subset=['prenom', 'nom'],keep=False)
df2=df2.drop_duplicates(subset=['prenom', 'nom'],keep=False)



# Attention merge est sensible à la casse
# Il faut enlever les doublons pour éviter d'assigner les informations du doublon 1 au doublon 2
# joint : gauche. Merge uniquement sur le fichier email

df = pd.merge(df1,df2,on=['nom','prenom'], how='outer', indicator=True, validate=None)




# print le csv en utf8, indiquer le dossier

df.to_csv('/Users/VPV/Desktop/Out.csv', encoding='utf8', index=False)